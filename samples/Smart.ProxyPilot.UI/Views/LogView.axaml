<UserControl
    x:Class="Smart.ProxyPilot.UI.Views.LogView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:Smart.ProxyPilot.UI.ViewModels"
    xmlns:models="using:Smart.ProxyPilot.UI.Models"
    xmlns:converters="using:Smart.ProxyPilot.UI.Converters"
    x:DataType="vm:MainViewModel">

  <Border Background="{DynamicResource SemiGrey0}" BorderThickness="0,1,0,0" BorderBrush="{DynamicResource SemiGrey2}">
    <Grid RowDefinitions="Auto,Auto">
      <!-- 标题栏 -->
      <Border Grid.Row="0" Padding="12,8" Background="{DynamicResource SemiGrey1}">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
            <TextBlock Text="实时日志" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center" />
            <Border
              Background="{DynamicResource SemiGrey2}"
              CornerRadius="10"
              Padding="8,2"
              VerticalAlignment="Center">
              <TextBlock Text="{Binding Logs.Count}" FontSize="11" Foreground="{DynamicResource SemiGrey6}" />
            </Border>
          </StackPanel>

          <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
            <ComboBox SelectedItem="{Binding LogFilter}" PlaceholderText="全部" Width="90" Padding="8,4">
              <ComboBoxItem Content="全部" />
              <ComboBoxItem Content="Debug" />
              <ComboBoxItem Content="Info" />
              <ComboBoxItem Content="Warning" />
              <ComboBoxItem Content="Error" />
            </ComboBox>
            <CheckBox IsChecked="{Binding AutoScroll}" Content="自动滚动" FontSize="12" VerticalAlignment="Center" />
            <Button Command="{Binding ClearLogsCommand}" Classes="Tertiary" Content="清空" Padding="12,4" />
          </StackPanel>
        </Grid>
      </Border>

      <!-- 日志列表 -->
      <ListBox
        Grid.Row="1"
        ItemsSource="{Binding Logs}"
        Background="Transparent"
        BorderThickness="0"
        MaxHeight="180"
        Padding="4">
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="models:LogEntry">
            <Grid ColumnDefinitions="70,60,*" Margin="4,2">
              <TextBlock
                Grid.Column="0"
                Text="{Binding Timestamp, StringFormat={}{0:HH:mm:ss}}"
                Foreground="{DynamicResource SemiGrey4}"
                FontFamily="Consolas,Menlo,monospace"
                FontSize="12" />
              <TextBlock
                Grid.Column="1"
                Text="{Binding Category, StringFormat=[{0}]}"
                Foreground="{Binding Level, Converter={x:Static converters:LogLevelToColorConverter.Instance}}"
                FontWeight="SemiBold"
                FontSize="12" />
              <TextBlock
                Grid.Column="2"
                Text="{Binding Message}"
                FontFamily="Consolas,Menlo,monospace"
                FontSize="12"
                TextTrimming="CharacterEllipsis" />
            </Grid>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </Grid>
  </Border>
</UserControl>
