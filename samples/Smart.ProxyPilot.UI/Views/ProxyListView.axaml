<UserControl
    x:Class="Smart.ProxyPilot.UI.Views.ProxyListView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:Smart.ProxyPilot.UI.ViewModels"
    xmlns:converters="using:Smart.ProxyPilot.UI.Converters"
    x:DataType="vm:ProxyListViewModel">

  <Border Padding="12" Margin="0,8,0,8">
    <Grid RowDefinitions="Auto,*,Auto">
      <!-- 搜索和筛选 -->
      <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,0,0,12">
        <TextBox
          Text="{Binding SearchText}"
          Watermark="搜索 IP 或端口..."
          Width="200" />
        <ComboBox PlaceholderText="全部状态" Width="120">
          <ComboBoxItem Content="全部" />
          <ComboBoxItem Content="可用" Tag="Available" />
          <ComboBoxItem Content="验证中" Tag="Validating" />
          <ComboBoxItem Content="冷却中" Tag="Cooldown" />
          <ComboBoxItem Content="已禁用" Tag="Disabled" />
        </ComboBox>
        <Button Command="{Binding RefreshCommand}" Classes="Tertiary" Content="刷新" />
      </StackPanel>

      <!-- 代理列表 -->
      <DataGrid
        Grid.Row="1"
        ItemsSource="{Binding Proxies}"
        SelectedItem="{Binding SelectedProxy}"
        AutoGenerateColumns="False"
        IsReadOnly="True"
        GridLinesVisibility="Horizontal"
        BorderThickness="1"
        BorderBrush="{DynamicResource SemiGrey2}">
        <DataGrid.Columns>
          <DataGridTemplateColumn Header="状态" Width="50">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate x:DataType="vm:ProxyItemViewModel">
                <Ellipse
                  Width="10" Height="10"
                  Fill="{Binding State, Converter={x:Static converters:ProxyStateToColorConverter.Instance}}"
                  HorizontalAlignment="Center" />
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
          <DataGridTextColumn Header="地址" Binding="{Binding Address}" Width="*" />
          <DataGridTextColumn Header="类型" Binding="{Binding ProxyType}" Width="70" />
          <DataGridTextColumn Header="延迟" Binding="{Binding ResponseTimeText}" Width="70" />
          <DataGridTextColumn Header="状态" Binding="{Binding StateText}" Width="70" />
        </DataGrid.Columns>
      </DataGrid>

      <!-- 分页 -->
      <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12" Margin="0,12,0,0">
        <Button Command="{Binding PrevPageCommand}" Classes="Tertiary" Content="上一页" />
        <TextBlock VerticalAlignment="Center">
          <Run Text="第 " /><Run Text="{Binding CurrentPage}" /><Run Text=" / " /><Run Text="{Binding TotalPages}" /><Run Text=" 页" />
        </TextBlock>
        <Button Command="{Binding NextPageCommand}" Classes="Tertiary" Content="下一页" />
      </StackPanel>
    </Grid>
  </Border>
</UserControl>
